name: GovCMS release version check

on:
  push:
    branches: 'release/3.x/3.[0-9]+.[0-9]+'

permissions:
  contents: read


jobs:
  check-version:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Get GovCMS version
        id: getGovcmsVersion
        uses: mikefarah/yq@master
        with:
          cmd: yq '.version' 'govcms.info.yml'
      - name: Check branch and govcms version are equal
        run: |
          echo ${{ steps.getGovcmsVersion.outputs.result }}
          G_VERSION="${{ steps.getGovcmsVersion.output.result }}"
          echo "GovCMS version defined as ${G_VERSION}"
          echo "Current branch is ${GITHUB_REF}"
          B_VERSION=$(echo $GITHUB_REF | cut -d '/' -f 5)
          echo "Branch version is set to ${B_VERSION}"
          if [[ "$G_VERSION" -ne "$B_VERSION" ]]; then
            echo "GovCMS and Branch versions are not equal."
            exit 1
          fi
